---

- hosts: localhost
  connection: local
  gather_facts: true

  vars:
    region: "{{ lookup('env', 'AWS_REGION') }}"
    image_name: "{{ lookup('env', 'ECS_IMAGE_NAME') }}"
    image_owner: "{{ lookup('env', 'ECS_IMAGE_OWNER') }}"

    cluster_name: "ecs-cluster-{{region}}"
    instance_type: "t2.micro"
    instance_monitoring: "no"
    health_check_period: "300"
    health_check_type: "EC2"
    min_size: 1
    max_size: 3
    desired_capacity: 1
    replace_all_instances: "yes"

  pre_tasks:
    - include_vars: "{{playbook_dir}}/group_vars/{{region}}"

  roles:
    - ec2-provision-ecs
